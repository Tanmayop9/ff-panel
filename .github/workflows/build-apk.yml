name: Build Ultra Advanced FF Panel APK

on:
  push:
    branches: [ main, master, copilot/** ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
        
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y apktool zipalign
        
    - name: Build APK with apktool
      run: |
        cd decompiled
        apktool b . -o ../ULTRA_ADVANCED_FF_PANEL_unsigned.apk
        
    - name: Generate keystore
      run: |
        keytool -genkey -v -keystore release.jks \
          -keyalg RSA -keysize 2048 -validity 10000 \
          -alias release-key \
          -dname "CN=FF Panel, OU=Development, O=FF Panel, L=Unknown, S=Unknown, C=US" \
          -storepass android -keypass android
          
    - name: Sign APK
      run: |
        jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 \
          -keystore release.jks -storepass android -keypass android \
          ULTRA_ADVANCED_FF_PANEL_unsigned.apk release-key
          
    - name: Zipalign APK
      run: |
        zipalign -v 4 ULTRA_ADVANCED_FF_PANEL_unsigned.apk ULTRA_ADVANCED_FF_PANEL.apk
        
    - name: Upload APK artifact
      uses: actions/upload-artifact@v4
      with:
        name: ULTRA_ADVANCED_FF_PANEL
        path: ULTRA_ADVANCED_FF_PANEL.apk
        retention-days: 30
        
    - name: Get APK info
      run: |
        ls -lh ULTRA_ADVANCED_FF_PANEL.apk
        echo "âœ… APK built successfully!"
